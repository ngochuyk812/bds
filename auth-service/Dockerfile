FROM golang:1.24.1 AS builder

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .

RUN go build -o main ./cmd/v1

FROM debian:bookworm-slim

WORKDIR /app

COPY --from=builder /app/main .
COPY --from=builder /app/migration ./migration

ENV BROKERS_EVENTBUS=kafka:9092
ENV TOPIC_EVENTBUS=topic
ENV SERVER_PORT=8080
ENV REDIS_CONNECTION=redis:6379
ENV REDIS_PASS=ngochuy123
ENV DB_CONNECTION=root:123321huy@tcp(10.0.0.10:3306)/auth-service?tls=false
ENV DB_NAME=auth-service
ENV SECRET_KEY=YTVkZDg1YjUzMTk0MjM3N2U5ZGFmYTdlYjMxZDZhOTcwNmQxZGU2YTQzZDNjMTQ4Mzc1MjkwMzY2ZTJmMGMyOGZjNDk3YjRhNWI3Mzg4Mzc0YWVkOTY4MjZiOTkxMjY4MjkyNTMyYWQ4MTg2NGYwZTc5YmU4ZGQ3ODQwZWVjMTFkZDA4MTRkMTBmOTY4NWJmN2I5MDhiNzI4ZDU0OWVmYjJjYjY2MzlkNWUzOGM0NzJkYTc1NTE1ZWQwNTFlZmI2MGYzNmY2NDc5M2RhYTNhMTA3ZjZhNTJhNGZlNTgwY2QxODM2M2JkODUzYzY2NjIzZjhhOWNhZDU2YzNmMThhYTgwYTAyMzE4NzMwOTkzOTc2YWJiYzFhNDk3NTA2NGZiNzc1MzRkZTk5Zjg3NWUzYTdmOTEzNDM4ZTRlOTNjMGRiOGIwNDhhMTA5YWEzOWNmOTAxOTQ4YzNjMWUyNTRkNGY2YjkyMTI0OWJkNTFjMDRiYmViZDM4N2JlYjVmNzEx


EXPOSE $SERVER_PORT

CMD ["./main"]
